<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Brendan Approval Rating</title>
</head>
<body>
  <h1>How cool is Brendan:</h1>
  <h2 class="rating-display"></h2>
  <button id="increase-btn">Increase Brendan's Rating</button>
  <button id="decrease-btn">Decrease Brendan's Rating</button>
  <script type="module">
    // Import the functions you need from the SDKs you need

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    // TODO: Add SDKs for Firebase products that you want to use

    // https://firebase.google.com/docs/web/setup#available-libraries


    // Your web app's Firebase configuration

    const firebaseConfig = {

        apiKey: "AIzaSyCU4U-X7Q2uAQwOyRwVifmrb0_hi7ObzLQ",

        authDomain: "brendan-approval-rating.firebaseapp.com",

        projectId: "brendan-approval-rating",

        storageBucket: "brendan-approval-rating.firebasestorage.app",

        messagingSenderId: "889025841523",

        appId: "1:889025841523:web:11bf606ebb90f6c1419d06"

    };


    // Initialize Firebase

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const ratingDocRef = doc(db, "data", "rating")

    let rating = 50;

    function increaseRating() {updateRating(rating + 1)};
    function decreaseRating() {updateRating(rating - 1)};

    async function loadRating() {
        const docSnapshot = await getDoc(ratingDocRef);
        if (docSnapshot.exists()) {
            rating = docSnapshot.data().value;
        }
        updateRating(rating);
    }

    async function saveRating(rating) {
        await setDoc(ratingDocRef, { value: rating });
    }

    function updateRating(newRating) {
        if (newRating >= 80) {
            document.querySelector('.rating-display').style.color = 'green';
        } else if (newRating <= 20) {
            document.querySelector('.rating-display').style.color = 'red';
        } else {
            document.querySelector('.rating-display').style.color = 'black';
        }
        if (newRating <= 100 && newRating >= 0) {
            rating = newRating;
            saveRating(rating);
        }
        document.querySelector('.rating-display').textContent = `${rating}%`;
    }

    document.getElementById('increase-btn').addEventListener('click', increaseRating);
    document.getElementById('decrease-btn').addEventListener('click', decreaseRating);

    loadRating();
  </script>
</body>
</html>